go back to [[electro:simulide-sensors|Adding Sensors to SimulIDE]]

====== Add an analog sensor to SimulIDE ======

===== Check initial build with original source files =====

After decompressing the sources, we consider make the change using Linux. The procedure should be similar with Windows10 or MacOS. First we build and test the initial configuration with the original source files :

<code bash>
cp -r build_xx build_linux
cd build_linux
qmake
make
./executables/SimulIDE_0.4.15-Final/bin/simulide 
</code>

We supposed all required QT5 packages have been installed. If not qmake will tell what packages are missing and have to be installed. If everything goes fine, the SimulIDE window should appear.

If git is used to manage the code, the following lines may be added in .gitignore :
<code bash>
 # build and release dir
build_linux/build
build_linux/release
build_linux/executables
build_linux/debug
build_linux/Makefile*
build_linux/qrc_application.cpp
build_linux/.qmake.stash
build_linux/SimulIDE_Build.pro.user
</code>

===== Create a Sensor Class =====
This step makes more simple addingnew resistive analog sensors.
Many analog resistive sensors will be similar : an electrical parameter (resistance, capacity, etc.) will change with the measured value of a physical parameter (temperature, force, illumination, etc.). The change of the physical value is controlled with a rotary dial button. The min, max values and the steps are defined as parameters of the component. A generic **Sensor** class (sensor.cpp, senseor.h) has been defined in :
<code bash>
src/gui/circuitwidget/components/passive/
</code>  

The value measured by the sensor is in the **sense** variable.

===== Create a Resistive Strain Gauge =====
The strain gauge sensor is defined by the **SensorStrainGauge** class (sensor_strain_gauge.cpp and sensor_strain_gauge.h) in the same folder :
<code bash>
src/gui/circuitwidget/components/passive/
</code> 
This class inherits from both Sensor and Component classes. We will now have a quick view on this code and explain the main elements.

First we have to insert the sensor in the SimulIDE item library. To avoid polluting existing components, we create a new group called "Experimental Ensta Bretagne" where we define the sensor with a short name, an icon and the corresponding class :
<code c++>

// create an entry with this component in the item library
LibraryItem* SensorStrainGauge::libraryItem()
{
    return new LibraryItem(
        tr( "Force - Metal Strain Gauge" ),
        tr( "Experimental Ensta Bretagne" ),
        "sensor_strain_gauge.png",
        "Force sensor (strain gauge)",
        SensorStrainGauge::construct );
}
</code>


===== Adding an Icon or an Image =====
We may need images or icon to show the sensor either in the item library or in the circuit design area. In the circuit area, the display of the component if a combination of Qt graphics and images. First we add the image (ex sensor_strain_gauge.png in Downloads folder) in the **src/icons/components** folder :
<code bash>
cp ~/Downloads/sensor_strain_gauge.png src/icons/components/
</code>
Then an alias is defined at the end of **src/application.qrc** file before </qresource> :
<code xml>
<file alias="sensor_strain_gauge.png">../src/icons/components/sensor_strain_gauge.png</file>
</code>

===== Adding the Sensor in the Item Library =====
The sensor is now added in the item library by adding 2 lines in **src/gui/circuitwidget/itemlibrary.cpp** file. First we include the definition of the sensor class in the include section of the code :
<code c++>
#include "sensor_strain_gauge.h"
</code>
